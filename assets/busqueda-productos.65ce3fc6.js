import{_,d as y,o as n,c as a,a as e,w as l,v as k,b as g,e as v,f as m,g as c,h,t as i,F as q,r as E,i as b}from"./index.252bb9b5.js";const P=y({data(){return{queryBusqueda:"",queryBusquedaOG:"",code:"",results:[],resultsOG:[],precioAsc:!1,vendidosAsc:!1,eshopAsc:!1,tablaFormateada:[],filtroCuotas:"yes",filtraCuotas:!1,filtroEstado:"2230284",filtraEstado:!1,filtroEnvios:"free",filtraEnvios:!1,ordenPrecios:!0,itmPrice:"",keyword:""}},mounted(){var t=window.localStorage.getItem("token");t==null&&this.checkParam(),this.checkParam()},methods:{checkParam(){console.log("checkparam"),this.$nextTick(()=>{console.log("checkparam 2");const t=new URLSearchParams(window.location.search);this.keyword=t.get("key"),this.itmPrice=t.get("price"),this.keyword&&(this.queryBusqueda=this.keyword,this.buscarQuery())})},queryFiltros(){var t="";return this.filtraCuotas&&(t="&installments="+this.filtroCuotas),this.filtraEstado&&(t+="&ITEM_CONDITION="+this.filtroEstado),this.filtraEnvios&&this.filtroEnvios!=""&&(t+="&shipping_cost="+this.filtroEnvios),t},ordenPorPrecios(){this.ordenPrecios?this.results=this.results.sort((t,o)=>o.price-t.price):this.results=this.results.sort((t,o)=>t.price-o.price),this.ordenPrecios=!this.ordenPrecios},buscarQuery(){var t=this.queryFiltros();this.tablaFormateada=[];var o=window.localStorage.getItem("token");this.queryBusquedaOG=this.queryBusqueda;var r=this.queryBusqueda.replaceAll(" ","%20"),u=0,p=[],f=this;function s(){$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?q="+r+t+"&offset="+u,authorization:"Bearer "+o}).then(d=>{p.push(...d.results),f.resultsOG=p,d.results.length>0&&u<1e3?(u+=50,s()):f.results=p}).catch(d=>{d.response.error=="invalid_grant"&&b.checkParam(),d.response.message=="Invalid token"&&b.refreshToken(),console.log(d)})}s()},formatTable(){this.results.forEach(t=>{var r,u,p,f;var o={titulo:t.title,linkpubli:t.permalink,linkvendedor:t.seller.permalink,nombreeshop:t.seller.eshop!=null?t.seller.eshop.nick_name:"-",condicion:t.condition,precio:t.price,disponibles:t.available_quantity,vendidos:t.sold_quantity,cuotas:(u=(r=t.installments)==null?void 0:r.quantity)!=null?u:"-",intereses:(f=(p=t.installments)==null?void 0:p.rate)!=null?f:"-",envio:t.shipping.free_shipping};t.installments==null&&console.log(t),this.tablaFormateada.push(o)})},exportXlsx(){this.formatTable();var t=this.queryBusquedaOG.replaceAll(" ","-"),o=XLSX.utils.json_to_sheet(this.tablaFormateada);const r=XLSX.utils.book_new();XLSX.utils.book_append_sheet(r,o,"Publicaciones"),XLSX.utils.sheet_add_aoa(o,[["titulo","link de la publicacion","link del vendedor","nombre del Eshop","condicion","precio","cantidad disponible","cantidad vendidos","cuotas","interes","envio gratis"]],{origin:"A1"}),XLSX.writeFile(r,t+".xlsx",{compression:!0})}}}),w={class:"container"},C=e("h2",null,"Metricas de de busqueda por producto",-1),B={class:"flex-inline"},V=["disabled"],U={class:"flex-inline-left",style:{"margin-top":"15px","margin-bottom":"5px"}},X={class:"flex-inline-left"},S={for:"festado"},T={key:0},F={class:"gap"},L=e("br",null,null,-1),A=e("label",{for:"nuevo"},"Nuevo",-1),I={class:"gap"},O=e("br",null,null,-1),G=e("label",{for:"usado"},"Usado",-1),M={class:"gap"},N=e("label",{for:"reacondicionado"},"Reacondicionado",-1),Q={class:"flex-inline-left"},R={for:"fcuotas"},j={key:0},D={class:"gap"},K=e("br",null,null,-1),z=e("label",{for:"interes"},"Todos",-1),H={class:"gap"},J=e("br",null,null,-1),W=e("label",{for:"nointeres"},"Sin interes",-1),Y={class:"flex-inline-left"},Z={for:"fenvios"},x={key:0},ee={class:"gap"},te=e("br",null,null,-1),se=e("label",{for:"enviogratis"},"Envio gratis",-1),oe={class:"gap"},ie=e("br",null,null,-1),le=e("label",{for:"enviopago"},"Todos",-1),ne={class:"flex-inline-between",style:{"margin-top":"15px","margin-bottom":"5px"}},ae={key:0},re={key:1},de={key:0,class:"table-responsive",style:{"margin-top":"20px"}},ue={id:"tabla",class:"table table-bordered"},pe=e("th",null,"img de portada",-1),ce=e("th",null,"titulo",-1),he=e("th",null,"cantidad disponible",-1),fe=e("th",null,"cantidad vendidos",-1),ve=e("th",null,"cuotas",-1),me=e("th",null,"interes",-1),be=e("th",null,"envio gratis",-1),_e=e("th",null,"link de la publicacion",-1),ye=e("th",null,"nombre del vendedor",-1),ke=e("th",null,"condicion",-1),ge=["src"],qe=["href"],Ee=e("p",null,"Las cantidades de items vendidos y disponibles son aproximaciones",-1);function Pe(t,o,r,u,p,f){return n(),a("div",w,[C,e("div",B,[l(e("input",{type:"text",class:"form-control",onKeyup:o[0]||(o[0]=g(s=>t.buscarQuery(),["enter"])),"onUpdate:modelValue":o[1]||(o[1]=s=>t.queryBusqueda=s)},null,544),[[k,t.queryBusqueda]]),e("button",{disabled:t.queryBusqueda=="",class:"btn btn-primary",onClick:o[2]||(o[2]=s=>t.buscarQuery())},"Buscar",8,V)]),e("div",U,[e("div",X,[e("label",S,[v("Estado del Item "),l(e("input",{id:"festado",type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=s=>t.filtraEstado=s)},null,512),[[m,t.filtraEstado]])]),t.filtraEstado?(n(),a("div",T,[e("div",F,[l(e("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>t.filtroEstado=s),value:"2230284",type:"radio",id:"nuevo",name:"estado",checked:""},null,512),[[c,t.filtroEstado]]),L,A]),e("div",I,[l(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>t.filtroEstado=s),value:"2230581",type:"radio",id:"usado",name:"estado"},null,512),[[c,t.filtroEstado]]),O,G]),e("div",M,[l(e("input",{"onUpdate:modelValue":o[6]||(o[6]=s=>t.filtroEstado=s),value:"2230582",type:"radio",id:"reacondicionado",name:"estado"},null,512),[[c,t.filtroEstado]]),N])])):h("",!0)]),e("div",Q,[e("label",R,[v("Cuotas "),l(e("input",{id:"fcuotas",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=s=>t.filtraCuotas=s)},null,512),[[m,t.filtraCuotas]])]),t.filtraCuotas?(n(),a("div",j,[e("div",D,[l(e("input",{"onUpdate:modelValue":o[8]||(o[8]=s=>t.filtroCuotas=s),value:"yes",type:"radio",id:"interes",name:"cuotas",checked:""},null,512),[[c,t.filtroCuotas]]),K,z]),e("div",H,[l(e("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>t.filtroCuotas=s),value:"no_interest",type:"radio",id:"nointeres",name:"cuotas"},null,512),[[c,t.filtroCuotas]]),J,W])])):h("",!0)]),e("div",Y,[e("label",Z,[v("Envio "),l(e("input",{id:"fenvios",type:"checkbox","onUpdate:modelValue":o[10]||(o[10]=s=>t.filtraEnvios=s)},null,512),[[m,t.filtraEnvios]])]),t.filtraEnvios?(n(),a("div",x,[e("div",ee,[l(e("input",{"onUpdate:modelValue":o[11]||(o[11]=s=>t.filtroEnvios=s),value:"free",type:"radio",id:"enviogratis",name:"envio",checked:""},null,512),[[c,t.filtroEnvios]]),te,se]),e("div",oe,[l(e("input",{"onUpdate:modelValue":o[12]||(o[12]=s=>t.filtroEnvios=s),value:"",type:"radio",id:"enviopago",name:"envio"},null,512),[[c,t.filtroEnvios]]),ie,le])])):h("",!0)])]),e("div",ne,[t.results.length>0?(n(),a("p",ae,"Cantidad: "+i(t.results.length),1)):h("",!0),t.itmPrice?(n(),a("p",re,"Precio propio: $"+i(t.itmPrice),1)):h("",!0),t.results.length>0?(n(),a("button",{key:2,onClick:o[13]||(o[13]=s=>t.exportXlsx()),class:"btn btn-outline-success"},"Exportar")):h("",!0)]),t.results.length>0?(n(),a("div",de,[e("table",ue,[e("thead",null,[e("tr",null,[pe,ce,e("th",null,[e("p",{class:"cursor-pointer",onClick:o[14]||(o[14]=s=>t.ordenPorPrecios())},"precio")]),he,fe,ve,me,be,_e,ye,ke])]),e("tbody",null,[(n(!0),a(q,null,E(t.results,(s,d)=>(n(),a("tr",{key:d},[e("td",null,[e("img",{style:{"max-width":"100px","max-height":"100px"},src:s.thumbnail,alt:"logo"},null,8,ge)]),e("td",null,i(s.title),1),e("td",null,i(s.price),1),e("td",null,i(s.available_quantity),1),e("td",null,i(s.sold_quantity),1),e("td",null,i(s.installments!=null?s.installments.quantity:"-"),1),e("td",null,"%"+i(s.installments!=null?s.installments.rate:"-"),1),e("td",null,i(s.shipping.free_shipping),1),e("td",null,[e("a",{href:s.permalink},i(s.permalink),9,qe)]),e("td",null,i(s.seller.nickname!=null?s.seller.nickname:"-"),1),e("td",null,i(s.condition),1)]))),128))])]),Ee])):h("",!0)])}const Ce=_(P,[["render",Pe]]);export{Ce as default};
